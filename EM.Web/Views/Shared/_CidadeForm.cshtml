@model EM.Domain.Models.Cidade

<div class="card shadow-sm">
    <div class="card-body">
        <form asp-action="@ViewData["Action"]" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="CIDACODIGO" />

            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

            <div class="row">
                <div class="col-md-8 mb-3">
                    <label asp-for="CIDADESCRICAO" class="form-label">Nome da Cidade</label>
                    <input asp-for="CIDADESCRICAO" type="text" class="form-control" placeholder="Nome da cidade" maxlength="100" required />
                    <span asp-validation-for="CIDADESCRICAO" class="text-danger"></span>
                </div>

                <div class="col-md-4 mb-3">
                    <label asp-for="CIDAUF" class="form-label">UF</label>
                    <select asp-for="CIDAUF" class="form-select" required>
                        <option value="">Selecione</option>
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AM">AM</option>
                        <option value="AP">AP</option>
                        <option value="BA">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MG">MG</option>
                        <option value="MS">MS</option>
                        <option value="MT">MT</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="PR">PR</option>
                        <option value="RJ">RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SE">SE</option>
                        <option value="SP">SP</option>
                        <option value="TO">TO</option>
                        <option value="EX">EX</option>
                    </select>
                    <span asp-validation-for="CIDAUF" class="text-danger"></span>
                </div>
            </div>

            <div class="mb-4">
                <label asp-for="CIDACODIGOIBGE" class="form-label">Código IBGE</label>
                <input asp-for="CIDACODIGOIBGE" 
                       type="text" 
                       class="form-control" 
                       placeholder="Código IBGE da cidade" 
                       maxlength="7" 
                       onkeypress="return apenasNumeros(event)"
                       oninput="this.value = this.value.replace(/\D/g, '')"
                       required />
                <span asp-validation-for="CIDACODIGOIBGE" class="text-danger"></span>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save me-1"></i>Salvar
                </button>
                <a href="@Url.Action("CidadeList", "Cidade")" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Voltar para lista
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            $('form').submit(function () {
                if (!$(this).valid()) {
                    return false;
                }
            });
        });

        async function buscarCidadePorCodigo(codigo) {
            try {
                var response = await fetch('/Cidade/BuscarCidadePorCodigo/' + codigo);
                if (response.ok) {
                    var cidade = await response.json();
                    $('#CIDADESCRICAO').val(cidade.CIDADESCRICAO);
                    $('#CIDAUF').val(cidade.CIDAUF);
                    $('#CIDACODIGOIBGE').val(cidade.CIDACODIGOIBGE);
                } else {
                    console.log('Cidade não encontrada.');
                }
            } catch (error) {
                console.error('Ocorreu um erro:', error);
            }
        }

        $(document).ready(function () {
            var codigoCidade = '@Model.CIDACODIGO';
            if (codigoCidade) {
                buscarCidadePorCodigo(codigoCidade);
            }
        });
    </script>
}